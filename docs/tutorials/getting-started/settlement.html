<!-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Settlement &mdash; Daml Finance  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
  
  <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
  <script src="../../_static/jquery.js"></script>
  <script src="../../_static/underscore.js"></script>
  <script src="../../_static/doctools.js"></script>
  <script src="../../_static/clipboard.min.js"></script>
  <script src="../../_static/copybutton.js"></script>
  
  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="index" title="Index" href="../../genindex.html" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="next" title="Lifecycling" href="lifecycling.html" />
  <link rel="prev" title="Transfer" href="transfer.html" /> 

  
  <link rel="icon" type="image/svg+xml"  href="../../_static/images/daml-logo-mark-light.svg">
  <link rel="alternate icon" href="../../_static/images/daml-favicon-1.ico">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MSWJMNX');</script>
  <!-- End Google Tag Manager -->
</head>

<body class="wy-body-for-nav">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MSWJMNX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-nav-side-shadow"></div>
      <div class="wy-side-scroll">

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
          
          
          
          
          
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Daml Finance Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/architecture.html">Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/asset-model.html">Asset model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/settlement.html">Settlement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/lifecycling.html">Lifecycling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../packages/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages/core-interfaces.html">Core Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages/core-implementations.html">Core Implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages/instrument-extensions.html">Instrument Extensions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="intro.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="transfer.html">Transfer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Settlement</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifecycling.html">Lifecycling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../instrument-modeling/intro.html">Instrument Modeling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../instrument-modeling/bond-extension.html">How to use the Bond extension package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../instrument-modeling/bond-lifecycling.html">How to lifecycle a bond instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../instrument-modeling/derivative-extension.html">How to use the Derivative extension to model generic instruments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../instrument-modeling/contingent-claims-instrument.html">How to implement a Contingent Claims-based instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../instrument-modeling/contingent-claims-on-ledger-vs-on-the-fly.html">Contingent Claims tree on ledger vs on-the-fly creation</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/index.html">Daml Finance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Data-Observable-Observation.html">Daml.Finance.Data.Observable.Observation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Data-Reference-HolidayCalendar.html">Daml.Finance.Data.Reference.HolidayCalendar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Holding-Account.html">Daml.Finance.Holding.Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Holding-Fungible.html">Daml.Finance.Holding.Fungible</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Holding-NonFungible.html">Daml.Finance.Holding.NonFungible</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Holding-NonTransferable.html">Daml.Finance.Holding.NonTransferable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Holding-Util.html">Daml.Finance.Holding.Util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-FixedRate-Factory.html">Daml.Finance.Instrument.Bond.FixedRate.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-FixedRate-Instrument.html">Daml.Finance.Instrument.Bond.FixedRate.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-FloatingRate-Factory.html">Daml.Finance.Instrument.Bond.FloatingRate.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-FloatingRate-Instrument.html">Daml.Finance.Instrument.Bond.FloatingRate.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-InflationLinked-Factory.html">Daml.Finance.Instrument.Bond.InflationLinked.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-InflationLinked-Instrument.html">Daml.Finance.Instrument.Bond.InflationLinked.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-ZeroCoupon-Factory.html">Daml.Finance.Instrument.Bond.ZeroCoupon.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Bond-ZeroCoupon-Instrument.html">Daml.Finance.Instrument.Bond.ZeroCoupon.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Equity-Factory.html">Daml.Finance.Instrument.Equity.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Equity-Instrument.html">Daml.Finance.Instrument.Equity.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Generic-Election.html">Daml.Finance.Instrument.Generic.Election</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Generic-Factory.html">Daml.Finance.Instrument.Generic.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Generic-Instrument.html">Daml.Finance.Instrument.Generic.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Generic-Util.html">Daml.Finance.Instrument.Generic.Util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-CreditDefault-Factory.html">Daml.Finance.Instrument.Swap.CreditDefault.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-CreditDefault-Instrument.html">Daml.Finance.Instrument.Swap.CreditDefault.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-Currency-Factory.html">Daml.Finance.Instrument.Swap.Currency.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-Currency-Instrument.html">Daml.Finance.Instrument.Swap.Currency.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-ForeignExchange-Factory.html">Daml.Finance.Instrument.Swap.ForeignExchange.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-ForeignExchange-Instrument.html">Daml.Finance.Instrument.Swap.ForeignExchange.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-InterestRate-Factory.html">Daml.Finance.Instrument.Swap.InterestRate.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Swap-InterestRate-Instrument.html">Daml.Finance.Instrument.Swap.InterestRate.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Token-Factory.html">Daml.Finance.Instrument.Token.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Instrument-Token-Instrument.html">Daml.Finance.Instrument.Token.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Claims-Claim.html">Daml.Finance.Interface.Claims.Claim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Claims-Types.html">Daml.Finance.Interface.Claims.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Claims-Util.html">Daml.Finance.Interface.Claims.Util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Claims-Util-Lifecycle.html">Daml.Finance.Interface.Claims.Util.Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Data-Observable.html">Daml.Finance.Interface.Data.Observable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Account.html">Daml.Finance.Interface.Holding.Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Base.html">Daml.Finance.Interface.Holding.Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Factory-Account.html">Daml.Finance.Interface.Holding.Factory.Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Factory-Holding.html">Daml.Finance.Interface.Holding.Factory.Holding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Fungible.html">Daml.Finance.Interface.Holding.Fungible</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Lockable.html">Daml.Finance.Interface.Holding.Lockable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Transferable.html">Daml.Finance.Interface.Holding.Transferable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Holding-Util.html">Daml.Finance.Interface.Holding.Util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Base-Instrument.html">Daml.Finance.Interface.Instrument.Base.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-FixedRate-Factory.html">Daml.Finance.Interface.Instrument.Bond.FixedRate.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-FixedRate-Instrument.html">Daml.Finance.Interface.Instrument.Bond.FixedRate.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-FixedRate-Types.html">Daml.Finance.Interface.Instrument.Bond.FixedRate.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-FloatingRate-Factory.html">Daml.Finance.Interface.Instrument.Bond.FloatingRate.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-FloatingRate-Instrument.html">Daml.Finance.Interface.Instrument.Bond.FloatingRate.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-FloatingRate-Types.html">Daml.Finance.Interface.Instrument.Bond.FloatingRate.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-InflationLinked-Factory.html">Daml.Finance.Interface.Instrument.Bond.InflationLinked.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-InflationLinked-Instrument.html">Daml.Finance.Interface.Instrument.Bond.InflationLinked.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-InflationLinked-Types.html">Daml.Finance.Interface.Instrument.Bond.InflationLinked.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-ZeroCoupon-Factory.html">Daml.Finance.Interface.Instrument.Bond.ZeroCoupon.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-ZeroCoupon-Instrument.html">Daml.Finance.Interface.Instrument.Bond.ZeroCoupon.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Bond-ZeroCoupon-Types.html">Daml.Finance.Interface.Instrument.Bond.ZeroCoupon.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Equity-Factory.html">Daml.Finance.Interface.Instrument.Equity.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Equity-Instrument.html">Daml.Finance.Interface.Instrument.Equity.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Generic-Election.html">Daml.Finance.Interface.Instrument.Generic.Election</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Generic-Factory.html">Daml.Finance.Interface.Instrument.Generic.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Generic-Instrument.html">Daml.Finance.Interface.Instrument.Generic.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-CreditDefault-Factory.html">Daml.Finance.Interface.Instrument.Swap.CreditDefault.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-CreditDefault-Instrument.html">Daml.Finance.Interface.Instrument.Swap.CreditDefault.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-CreditDefault-Types.html">Daml.Finance.Interface.Instrument.Swap.CreditDefault.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-Currency-Factory.html">Daml.Finance.Interface.Instrument.Swap.Currency.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-Currency-Instrument.html">Daml.Finance.Interface.Instrument.Swap.Currency.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-Currency-Types.html">Daml.Finance.Interface.Instrument.Swap.Currency.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-ForeignExchange-Factory.html">Daml.Finance.Interface.Instrument.Swap.ForeignExchange.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-ForeignExchange-Instrument.html">Daml.Finance.Interface.Instrument.Swap.ForeignExchange.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-ForeignExchange-Types.html">Daml.Finance.Interface.Instrument.Swap.ForeignExchange.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-InterestRate-Factory.html">Daml.Finance.Interface.Instrument.Swap.InterestRate.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-InterestRate-Instrument.html">Daml.Finance.Interface.Instrument.Swap.InterestRate.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Swap-InterestRate-Types.html">Daml.Finance.Interface.Instrument.Swap.InterestRate.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Token-Factory.html">Daml.Finance.Interface.Instrument.Token.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Token-Instrument.html">Daml.Finance.Interface.Instrument.Token.Instrument</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Instrument-Token-Types.html">Daml.Finance.Interface.Instrument.Token.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Clock.html">Daml.Finance.Interface.Lifecycle.Clock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Effect.html">Daml.Finance.Interface.Lifecycle.Effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Event.html">Daml.Finance.Interface.Lifecycle.Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Event-Distribution.html">Daml.Finance.Interface.Lifecycle.Event.Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Event-Replacement.html">Daml.Finance.Interface.Lifecycle.Event.Replacement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Event-Time.html">Daml.Finance.Interface.Lifecycle.Event.Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Rule-Claim.html">Daml.Finance.Interface.Lifecycle.Rule.Claim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Lifecycle-Rule-Lifecycle.html">Daml.Finance.Interface.Lifecycle.Rule.Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Batch.html">Daml.Finance.Interface.Settlement.Batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Factory.html">Daml.Finance.Interface.Settlement.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Instruction.html">Daml.Finance.Interface.Settlement.Instruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Types.html">Daml.Finance.Interface.Settlement.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Types-Common.html">Daml.Finance.Interface.Types.Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Types-Date-Calendar.html">Daml.Finance.Interface.Types.Date.Calendar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Types-Date-Classes.html">Daml.Finance.Interface.Types.Date.Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Types-Date-DayCount.html">Daml.Finance.Interface.Types.Date.DayCount</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Types-Date-RollConvention.html">Daml.Finance.Interface.Types.Date.RollConvention</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Types-Date-Schedule.html">Daml.Finance.Interface.Types.Date.Schedule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Util-Common.html">Daml.Finance.Interface.Util.Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Util-Disclosure.html">Daml.Finance.Interface.Util.Disclosure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-DateClock.html">Daml.Finance.Lifecycle.DateClock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Effect.html">Daml.Finance.Lifecycle.Effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-ElectionEffect.html">Daml.Finance.Lifecycle.ElectionEffect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Event-DateClock.html">Daml.Finance.Lifecycle.Event.DateClock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Event-Distribution.html">Daml.Finance.Lifecycle.Event.Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Event-Replacement.html">Daml.Finance.Lifecycle.Event.Replacement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Rule-Claim.html">Daml.Finance.Lifecycle.Rule.Claim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Rule-Distribution.html">Daml.Finance.Lifecycle.Rule.Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Rule-Replacement.html">Daml.Finance.Lifecycle.Rule.Replacement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Lifecycle-Types.html">Daml.Finance.Lifecycle.Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Settlement-Batch.html">Daml.Finance.Settlement.Batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Settlement-Factory.html">Daml.Finance.Settlement.Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Settlement-Instruction.html">Daml.Finance.Settlement.Instruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Util-Common.html">Daml.Finance.Util.Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Util-Date-Calendar.html">Daml.Finance.Util.Date.Calendar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Util-Date-DayCount.html">Daml.Finance.Util.Date.DayCount</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Util-Date-RollConvention.html">Daml.Finance.Util.Date.RollConvention</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Util-Date-Schedule.html">Daml.Finance.Util.Date.Schedule</a></li>
</ul>
</li>
</ul>

          
          
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <div class="topbar fixed">
        
        <nav class="wy-nav-top" aria-label="top navigation">
          
          <i data-toggle="wy-nav-top" class="wy-nav-top-toggle"></i>
          
        </nav>
        <!-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="navbar">
    <h1><img src="../../_static/images/Daml_Logo_Blue.svg"></h1>
    <div class="navbar-menu">
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/developers" role="menuitem" class="da-menu-link">Developers</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com/products" role="menuitem" class="da-menu-link">Products</a>
        </div>
        <div class="da-menu-item da-menu-depth-1" role="menu">
            <a href="https://www.digitalasset.com" role="menuitem" class="da-menu-link">Company</a>
        </div>
    </div>
</div>

        <div class="version ">
          <span class="hide-mobile">Version&nbsp;</span><span class="version_switcher_placeholder"></span>
          
        </div>


        <!-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->
<div class="search-inline">
    <div id="rtd-search-inline-form" class="wy-form">
        <input type="text" class="search-inline-input" placeholder="Search" name="q">
        <img src="../../_static/images/Search.svg" class="search-inline-img"/>
    </div>
    <div class="search-alert">
        Please enter at least 3 letters.
    </div>
    <div id="search-inline-results" class="search-inline-results">
        
    </div>
</div>
          <!-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<div class="content-menu collapsed">
    <span class="content-menu-title">In This Section</span>
    <span class="content-menu-expand"></span>
    <div class="content-menu-wrapper">
        
        <!-- Local TOC -->
        <div class="content-menu-toc"><ul>
<li><a class="reference internal" href="#">Settlement</a><ul>
<li><a class="reference internal" href="#overview-of-the-process">Overview of the process</a></li>
<li><a class="reference internal" href="#running-the-script">Running the script</a></li>
<li><a class="reference internal" href="#frequently-asked-questions">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#why-do-we-need-a-settlement-factory">Why do we need a settlement factory?</a></li>
<li><a class="reference internal" href="#can-we-use-a-different-settler">Can we use a different settler?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</div>
        
    </div>
</div>
        

      </div>
      <div class="wy-nav-content">
        
        <div class="rst-content">
          
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
                
  <div class="section" id="settlement">
<h1>Settlement<a class="headerlink" href="#settlement" title="Permalink to this headline">¶</a></h1>
<p>This tutorial introduces the settlement features of the library through a simple example.
The purpose is to demonstrate how multiple holding transfers can be executed atomically.</p>
<p>We are going to</p>
<ol class="arabic simple">
<li>create a new <code class="docutils literal notranslate"><span class="pre">TOKEN</span></code> instrument</li>
<li>credit a token holding to Alice’s account</li>
<li>setup a delivery-vs-payment (DvP) transaction to exchange the two holdings</li>
<li>settle this transaction atomically</li>
</ol>
<p>This example builds on the previous <a class="reference internal" href="transfer.html"><span class="doc">Transfer</span></a> tutorial script such that the same
accounts and existing holdings can be used.</p>
<div class="section" id="overview-of-the-process">
<h2>Overview of the process<a class="headerlink" href="#overview-of-the-process" title="Permalink to this headline">¶</a></h2>
<p>We first give a quick outline of the settlement process.</p>
<table border="1" class="docutils align-default">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple">
<li>Define steps to be settled</li>
</ol>
</td>
<td>Two (or more) parties need to first agree on a set of <a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Types.html#type-daml-finance-interface-settlement-types-step-78661"><span class="std std-ref">steps</span></a> to be settled.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="2">
<li>Generate settlement instructions</li>
</ol>
</td>
<td><p class="first"><a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Instruction.html#type-daml-finance-interface-settlement-instruction-instruction-30569"><span class="std std-ref">Instructions</span></a> are generated for each step.
An instruction is a contract where the sender can specify its
<a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Types.html#type-daml-finance-interface-settlement-types-allocation-46483"><span class="std std-ref">Allocation</span></a> preference for the instruction,
e.g., the matching holding they wish to send,
and the receiver can specify its
<a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Types.html#type-daml-finance-interface-settlement-types-approval-84286"><span class="std std-ref">Approval</span></a> preference for the instruction,
e.g., the account they wish to receive the holding to.</p>
<p class="last">The creation of Instructions is done using a
<a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Factory.html#type-daml-finance-interface-settlement-factory-factory-31525"><span class="std std-ref">Settlement Factory</span></a> contract.</p>
</td>
</tr>
<tr class="row-odd"><td><ol class="first last arabic simple" start="3">
<li>Allocate and approve instructions</li>
</ol>
</td>
<td>For every instruction, the sender and receiver specify their allocation and approval preferences, respectively.</td>
</tr>
<tr class="row-even"><td><ol class="first last arabic simple" start="4">
<li>Settle the batch</li>
</ol>
</td>
<td><p class="first">A <a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Batch.html#type-daml-finance-interface-settlement-batch-batch-97497"><span class="std std-ref">Batch</span></a> contract is used to settle all instructions atomically according
to the specified preferences (e.g., by transfering all allocated holdings to the corresponding receiving accounts).</p>
<p class="last">This batch contract is created in step 2, together with the settlement instructions.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="running-the-script">
<h2>Running the script<a class="headerlink" href="#running-the-script" title="Permalink to this headline">¶</a></h2>
<p>The code for this tutorial can be executed via the <code class="docutils literal notranslate"><span class="pre">runSettlement</span></code> function in the <code class="docutils literal notranslate"><span class="pre">Settlement.daml</span></code> module.</p>
<p>The first part executes the script from the previous <a class="reference internal" href="transfer.html"><span class="doc">Transfer</span></a> tutorial to arrive at the initial state for this scenario.
We then create an additional <em>token</em> instrument and credit Alice’s account with it.</p>
<p>The interesting bit starts once Alice proposes the DvP trade to Bob. Before creating the DvP proposal, we need to instantiate a <a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Factory.html#type-daml-finance-interface-settlement-factory-factory-31525"><span class="std std-ref">Settlement Factory</span></a> contract.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">settlementFactoryCid</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">toInterfaceContractId</span><span class="w"> </span><span class="o">@</span><span class="kt">Factory</span><span class="o">.</span><span class="kt">I</span><span class="w"> </span><span class="o">&lt;$&gt;</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">bank</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="n">createCmd</span><span class="w"> </span><span class="kt">Factory</span><span class="w"></span>
<span class="w">      </span><span class="kr">with</span><span class="w"></span>
<span class="w">        </span><span class="n">provider</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">bank</span><span class="w"></span>
<span class="w">        </span><span class="n">observers</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">S</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span><span class="n">alice</span><span class="p">,</span><span class="w"> </span><span class="n">bob</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<p>This is used to generate settlement instruction from settlement <a class="reference internal" href="../../reference/code-documentation/daml-finance-rst/Daml-Finance-Interface-Settlement-Types.html#type-daml-finance-interface-settlement-types-step-78661"><span class="std std-ref">steps</span></a>.</p>
<p>Alice creates a <code class="docutils literal notranslate"><span class="pre">Dvp.Proposal</span></code> template to propose the exchange of the <code class="docutils literal notranslate"><span class="pre">TOKEN</span></code> against <code class="docutils literal notranslate"><span class="pre">USD</span></code>.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">dvpProposalCid</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">bob</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="n">createCmd</span><span class="w"> </span><span class="kt">DvP</span><span class="o">.</span><span class="kt">Proposal</span><span class="w"> </span><span class="kr">with</span><span class="w"></span>
<span class="w">      </span><span class="n">id</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">&quot;xccy trade&quot;</span><span class="w"></span>
<span class="w">      </span><span class="n">recQuantity</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Instrument</span><span class="o">.</span><span class="n">qty</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="n">tokenInstrument</span><span class="w"></span>
<span class="w">      </span><span class="n">payQuantity</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Instrument</span><span class="o">.</span><span class="n">qty</span><span class="w"> </span><span class="mf">1000.0</span><span class="w"> </span><span class="n">usdInstrument</span><span class="w"></span>
<span class="w">      </span><span class="n">proposer</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">bob</span><span class="w"></span>
<span class="w">      </span><span class="n">counterparty</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">alice</span><span class="w"></span>
<span class="w">      </span><span class="n">settlementFactoryCid</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">settlementFactoryCid</span><span class="w"></span>
</pre></div>
</div>
<p>Bob then accepts the proposal, agreeing to the terms of the trade.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p">(</span><span class="n">batchCid</span><span class="p">,</span><span class="w"> </span><span class="n">recSettleInstructionCid</span><span class="p">,</span><span class="w"> </span><span class="n">paySettleInstructionCid</span><span class="p">)</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">dvpProposalCid</span><span class="w"> </span><span class="kt">DvP</span><span class="o">.</span><span class="kt">Accept</span><span class="w"></span>
</pre></div>
</div>
<p>Once the proposal is accepted, three contracts are created:</p>
<ul class="simple">
<li>an instruction to transfer <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">TOKEN</span></code> from Alice to Bob</li>
<li>an instruction to transfer <code class="docutils literal notranslate"><span class="pre">1000</span> <span class="pre">USD</span></code> from Bob to Alice</li>
<li>a batch contract to settle the two instructions atomically</li>
</ul>
<p>The workflow to create these contracts makes use of the settlement factory.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="p">(</span><span class="n">containerCid</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">recInstructionCid</span><span class="p">,</span><span class="w"> </span><span class="n">payInstructionCid</span><span class="p">])</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">exercise</span><span class="w"> </span><span class="n">settlementFactoryCid</span><span class="w"> </span><span class="kt">Factory</span><span class="o">.</span><span class="kt">Instruct</span><span class="w"> </span><span class="kr">with</span><span class="w"></span>
<span class="w">          </span><span class="n">instructors</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span><span class="n">proposer</span><span class="p">,</span><span class="w"> </span><span class="n">counterparty</span><span class="p">]</span><span class="w"></span>
<span class="w">          </span><span class="n">settler</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">proposer</span><span class="w"></span>
<span class="w">          </span><span class="n">id</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Id</span><span class="w"> </span><span class="n">id</span><span class="w"></span>
<span class="w">          </span><span class="n">steps</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span><span class="n">recStep</span><span class="p">,</span><span class="w"> </span><span class="n">payStep</span><span class="p">]</span><span class="w"></span>
<span class="w">          </span><span class="n">description</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">&quot;Settlement for &quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">id</span><span class="w"></span>
</pre></div>
</div>
<p>As a next step, Alice allocates her <code class="docutils literal notranslate"><span class="pre">TOKEN</span></code> holding to the corresponding instruction. Bob then approves the instruction specifying the receiving account.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">allocatedRecSettleInstructionCid</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">alice</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">recSettleInstructionCid</span><span class="w"> </span><span class="kt">Instruction</span><span class="o">.</span><span class="kt">Allocate</span><span class="w"> </span><span class="kr">with</span><span class="w"></span>
<span class="w">      </span><span class="n">allocation</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Pledge</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">coerceContractId</span><span class="w"> </span><span class="n">aliceHoldingCid</span><span class="w"></span>

<span class="w">  </span><span class="n">approvedRecSettleInstructionCid</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">bob</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">allocatedRecSettleInstructionCid</span><span class="w"> </span><span class="kt">Instruction</span><span class="o">.</span><span class="kt">Approve</span><span class="w"> </span><span class="kr">with</span><span class="w"></span>
<span class="w">      </span><span class="n">approval</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">TakeDelivery</span><span class="w"> </span><span class="n">bobAccount</span><span class="w"></span>
</pre></div>
</div>
<p>The same happens in the second instruction (where Bob allocates his <code class="docutils literal notranslate"><span class="pre">USD</span></code> holding and Alice provides the receiving account).</p>
<p>Now that all instructions are fully allocated and approved, they can be finally settled.</p>
<div class="highlight-daml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p">[</span><span class="n">bobHoldingCid</span><span class="p">,</span><span class="w"> </span><span class="n">aliceHoldingCid</span><span class="p">]</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">submitMulti</span><span class="w"> </span><span class="p">[</span><span class="n">bob</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">public</span><span class="p">]</span><span class="w"> </span><span class="kr">do</span><span class="w"></span>
<span class="w">    </span><span class="n">exerciseCmd</span><span class="w"> </span><span class="n">batchCid</span><span class="w"> </span><span class="kt">Batch</span><span class="o">.</span><span class="kt">Settle</span><span class="w"></span>
</pre></div>
</div>
<p>Within the same transaction, Alice receives a <code class="docutils literal notranslate"><span class="pre">USD</span></code> holding from Bob in exchange for a <code class="docutils literal notranslate"><span class="pre">TOKEN</span></code> holding.</p>
</div>
<div class="section" id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-do-we-need-a-settlement-factory">
<h3>Why do we need a settlement factory?<a class="headerlink" href="#why-do-we-need-a-settlement-factory" title="Permalink to this headline">¶</a></h3>
<p>A settlement factory contract is used to generate settlement <code class="docutils literal notranslate"><span class="pre">Instructions</span></code> from <code class="docutils literal notranslate"><span class="pre">steps</span></code>.
It also generates a <code class="docutils literal notranslate"><span class="pre">Batch</span></code> contract which is used to settle instructions atomically.</p>
<p>The first reason why the factory is needed has already been introduced in the previous tutorial:
it provides an interface abstraction, so that your workflow does not need to depend on concrete implementations
of <code class="docutils literal notranslate"><span class="pre">Batch</span></code> or <code class="docutils literal notranslate"><span class="pre">Instruction</span></code>.</p>
<p>A second aspect has to do with intermediated settlement.</p>
<p>Consider a real-world example where Alice instructs a bank transfer to send 100 USD to Bob. The following happens:</p>
<ul class="simple">
<li>100 USD are debited from Alice’s account at her bank</li>
<li>100 USD are transferred from Alice’s bank to Bob’s bank (via their accounts at the central bank)</li>
<li>100 USD are credited to Bob’s account at his bank</li>
</ul>
<p>A single <code class="docutils literal notranslate"><span class="pre">Step</span></code> requires three instructions to settle.</p>
<p>The same dynamics can be reproduced in Daml with the Settlement Factory, allowing for on-ledger intermediated settlement.
An example will be covered in one of the following tutorials.</p>
</div>
<div class="section" id="can-we-use-a-different-settler">
<h3>Can we use a different settler?<a class="headerlink" href="#can-we-use-a-different-settler" title="Permalink to this headline">¶</a></h3>
<p>In our example, Alice triggers the final settlement of the transaction (by exercising the <code class="docutils literal notranslate"><span class="pre">Settle</span></code> choice on the <code class="docutils literal notranslate"><span class="pre">Batch</span></code> contract).</p>
<p>In principle, a different settler could be chosen. The choice of a settler is usually quite delicate, as this party acquires visibility on the entire transaction and hence needs to be trusted.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>You now know how to define complex transactions and settle them atomically. The main points to take away are:</p>
<ul class="simple">
<li>A settlement factory is used to instruct settlement for an arbitrary list of steps</li>
<li>Instructions are used to collect authorizations, assets to be moved, and means of settlement</li>
<li>Batches group together instructions to be settled atomically</li>
</ul>
<p>In the next tutorial, we will introduce the lifecycling framework of the library, which is used to model the evolution of instruments.
The concepts introduced in this tutorial will be used to settle payments arising from lifecycle events.</p>
</div>
</div>


              
            </div>
            
            
              <!-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="transfer.html" class="da-btn da-btn-label btn-prev" title="Transfer" accesskey="p" rel="prev">Previous</a>
      
      
        <a href="lifecycling.html" class="da-btn da-btn-label btn-next" title="Lifecycling" accesskey="n" rel="next">Next</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. Any unauthorized use, duplication or distribution is strictly prohibited. &#34;Digital Asset&#34; and &#34;Daml&#34; are Registered in the U.S. Patent and Trademark Office.

    </p>
  </div> 

</footer>
            
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved. -->
<!-- SPDX-License-Identifier: Apache-2.0 -->





  <script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>


  
    
  
  <div id="inpageContent"></div>
  

</body>
</html>